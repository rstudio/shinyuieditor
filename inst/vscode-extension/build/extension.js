"use strict";var Ue=Object.create;var N=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ke=Object.getOwnPropertyNames;var Me=Object.getPrototypeOf,Oe=Object.prototype.hasOwnProperty;var De=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Ne=(n,e)=>{for(var t in e)N(n,t,{get:e[t],enumerable:!0})},Y=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ke(e))!Oe.call(n,r)&&r!==t&&N(n,r,{get:()=>e[r],enumerable:!(o=be(e,r))||o.enumerable});return n};var b=(n,e,t)=>(t=n!=null?Ue(Me(n)):{},Y(e||!n||!n.__esModule?N(t,"default",{value:n,enumerable:!0}):t,n)),Ie=n=>Y(N({},"__esModule",{value:!0}),n);var pe=De((ot,ue)=>{var W=require("util"),Be=require("path"),S=require("child_process").spawn,_=function(){},H="HKLM",Z="HKCU",q="HKCR",J="HKU",z="HKCC",X=[H,Z,q,J,z],ee="REG_SZ",te="REG_MULTI_SZ",ne="REG_EXPAND_SZ",oe="REG_DWORD",re="REG_QWORD",se="REG_BINARY",ie="REG_NONE",ae=[ee,te,ne,oe,re,se,ie],$e="",Fe=/(\\[a-zA-Z0-9_\s]+)*/,We=/^(HKEY_LOCAL_MACHINE|HKEY_CURRENT_USER|HKEY_CLASSES_ROOT|HKEY_USERS|HKEY_CURRENT_CONFIG)(.*)$/,ce=/^(.*)\s(REG_SZ|REG_MULTI_SZ|REG_EXPAND_SZ|REG_DWORD|REG_QWORD|REG_BINARY|REG_NONE)\s+([^\s].*)$/;function k(n,e){if(!(this instanceof k))return new k(n,e);Error.captureStackTrace(this,k),this.__defineGetter__("name",function(){return k.name}),this.__defineGetter__("message",function(){return n}),this.__defineGetter__("code",function(){return e})}W.inherits(k,Error);function x(n){var e={stdout:"",stderr:""};return n.stdout.on("data",function(t){e.stdout+=t.toString()}),n.stderr.on("data",function(t){e.stderr+=t.toString()}),e}function A(n,e,t){var o=t.stdout.trim(),r=t.stderr.trim(),s=W.format(`%s command exited with code %d:
%s
%s`,n,e,o,r);return new k(s,e)}function He(n){if(n=="x64")return"64";if(n=="x86")return"32";throw new Error("illegal architecture: "+n+" (use x86 or x64)")}function C(n,e){e&&n.push("/reg:"+He(e))}function U(){return process.platform==="win32"?Be.join(process.env.windir,"system32","reg.exe"):"REG"}function O(n,e,t,o,r,s,i){if(!(this instanceof O))return new O(n,e,t,o,r,s,i);var u=n,a=e,p=t,f=o,c=r,l=s,h=i;this.__defineGetter__("host",function(){return u}),this.__defineGetter__("hive",function(){return a}),this.__defineGetter__("key",function(){return p}),this.__defineGetter__("name",function(){return f}),this.__defineGetter__("type",function(){return c}),this.__defineGetter__("value",function(){return l}),this.__defineGetter__("arch",function(){return h})}W.inherits(O,Object);function d(n){if(!(this instanceof d))return new d(n);var e=n||{},t=""+(e.host||""),o=""+(e.hive||H),r=""+(e.key||""),s=e.arch||null;if(this.__defineGetter__("host",function(){return t}),this.__defineGetter__("hive",function(){return o}),this.__defineGetter__("key",function(){return r}),this.__defineGetter__("path",function(){return(t.length==0?"":"\\\\"+t+"\\")+o+r}),this.__defineGetter__("arch",function(){return s}),this.__defineGetter__("parent",function(){var i=r.lastIndexOf("\\");return new d({host:this.host,hive:this.hive,key:i==-1?"":r.substring(0,i),arch:this.arch})}),X.indexOf(o)==-1)throw new Error("illegal hive specified.");if(!Fe.test(r))throw new Error("illegal key specified.");if(s&&s!="x64"&&s!="x86")throw new Error("illegal architecture specified (use x86 or x64)")}d.HKLM=H;d.HKCU=Z;d.HKCR=q;d.HKU=J;d.HKCC=z;d.HIVES=X;d.REG_SZ=ee;d.REG_MULTI_SZ=te;d.REG_EXPAND_SZ=ne;d.REG_DWORD=oe;d.REG_QWORD=re;d.REG_BINARY=se;d.REG_NONE=ie;d.REG_TYPES=ae;d.DEFAULT_VALUE=$e;d.prototype.values=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["QUERY",this.path];C(t,this.arch);var o=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r="",s=this,i=null,u=x(o);return o.on("close",function(a){if(!i)if(a!==0)_("process exited with code "+a),e(A("QUERY",a,u),null);else{for(var p=[],f=[],c=r.split(`
`),l=0,h=0,m=c.length;h<m;h++){var E=c[h].trim();E.length>0&&(_(E),l!=0&&p.push(E),++l)}for(var h=0,m=p.length;h<m;h++){var v=ce.exec(p[h]),w,g,R;v&&(w=v[1].trim(),g=v[2].trim(),R=v[3],f.push(new O(s.host,s.hive,s.key,w,g,R,s.arch)))}e(null,f)}}),o.stdout.on("data",function(a){r+=a.toString()}),o.on("error",function(a){i=a,e(a)}),this};d.prototype.keys=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["QUERY",this.path];C(t,this.arch);var o=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r="",s=this,i=null,u=x(o);return o.on("close",function(a){i||a!==0&&(_("process exited with code "+a),e(A("QUERY",a,u),null))}),o.stdout.on("data",function(a){r+=a.toString()}),o.stdout.on("end",function(){for(var a=[],p=[],f=r.split(`
`),c=0,l=f.length;c<l;c++){var h=f[c].trim();h.length>0&&(_(h),a.push(h))}for(var c=0,l=a.length;c<l;c++){var m=We.exec(a[c]),E,v;m&&(E=m[1],v=m[2],v&&v!==s.key&&p.push(new d({host:s.host,hive:s.hive,key:v,arch:s.arch})))}e(null,p)}),o.on("error",function(a){i=a,e(a)}),this};d.prototype.get=function(e,t){if(typeof t!="function")throw new TypeError("must specify a callback");var o=["QUERY",this.path];e==""?o.push("/ve"):o=o.concat(["/v",e]),C(o,this.arch);var r=S(U(),o,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s="",i=this,u=null,a=x(r);return r.on("close",function(p){if(!u)if(p!==0)_("process exited with code "+p),t(A("QUERY",p,a),null);else{for(var f=[],c=null,l=s.split(`
`),h=0,m=0,E=l.length;m<E;m++){var v=l[m].trim();v.length>0&&(_(v),h!=0&&f.push(v),++h)}var w=f[f.length-1]||"",g=ce.exec(w),R,P,j;g&&(R=g[1].trim(),P=g[2].trim(),j=g[3],c=new O(i.host,i.hive,i.key,R,P,j,i.arch)),t(null,c)}}),r.stdout.on("data",function(p){s+=p.toString()}),r.on("error",function(p){u=p,t(p)}),this};d.prototype.set=function(e,t,o,r){if(typeof r!="function")throw new TypeError("must specify a callback");if(ae.indexOf(t)==-1)throw Error("illegal type specified.");var s=["ADD",this.path];e==""?s.push("/ve"):s=s.concat(["/v",e]),s=s.concat(["/t",t,"/d",o,"/f"]),C(s,this.arch);var i=S(U(),s,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),u=null,a=x(i);return i.on("close",function(p){u||(p!==0?(_("process exited with code "+p),r(A("ADD",p,a,null))):r(null))}),i.stdout.on("data",function(p){_(""+p)}),i.on("error",function(p){u=p,r(p)}),this};d.prototype.remove=function(e,t){if(typeof t!="function")throw new TypeError("must specify a callback");var o=e?["DELETE",this.path,"/f","/v",e]:["DELETE",this.path,"/f","/ve"];C(o,this.arch);var r=S(U(),o,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s=null,i=x(r);return r.on("close",function(u){s||(u!==0?(_("process exited with code "+u),t(A("DELETE",u,i),null)):t(null))}),r.stdout.on("data",function(u){_(""+u)}),r.on("error",function(u){s=u,t(u)}),this};d.prototype.clear=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["DELETE",this.path,"/f","/va"];C(t,this.arch);var o=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r=null,s=x(o);return o.on("close",function(i){r||(i!==0?(_("process exited with code "+i),e(A("DELETE",i,s),null)):e(null))}),o.stdout.on("data",function(i){_(""+i)}),o.on("error",function(i){r=i,e(i)}),this};d.prototype.erase=d.prototype.clear;d.prototype.destroy=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["DELETE",this.path,"/f"];C(t,this.arch);var o=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r=null,s=x(o);return o.on("close",function(i){r||(i!==0?(_("process exited with code "+i),e(A("DELETE",i,s),null)):e(null))}),o.stdout.on("data",function(i){_(""+i)}),o.on("error",function(i){r=i,e(i)}),this};d.prototype.create=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["ADD",this.path,"/f"];C(t,this.arch);var o=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r=null,s=x(o);return o.on("close",function(i){r||(i!==0?(_("process exited with code "+i),e(A("ADD",i,s),null)):e(null))}),o.stdout.on("data",function(i){_(""+i)}),o.on("error",function(i){r=i,e(i)}),this};d.prototype.keyExists=function(e){return this.values(function(t,o){if(t)return t.code==1?e(null,!1):e(t);e(null,!0)}),this};d.prototype.valueExists=function(e,t){return this.get(e,function(o,r){if(o)return o.code==1?t(null,!1):t(o);t(null,!0)}),this};ue.exports=d});var Xe={};Ne(Xe,{activate:()=>ze});module.exports=Ie(Xe);function Ge(n){return typeof n=="object"&&n!==null}function V(n){return Ge(n)?"path"in n:!1}var Q=Le;function Le(n,e,t){var o=null,r=null,s=function(){o&&(clearTimeout(o),r=null,o=null)},i=function(){var a=r;s(),a&&a()},u=function(){if(!e)return n.apply(this,arguments);var a=this,p=arguments,f=t&&!o;if(s(),r=function(){n.apply(a,p)},o=setTimeout(function(){if(o=null,!f){var c=r;return r=null,c()}},e),f)return r()};return u.cancel=s,u.flush=i,u}var y=b(require("vscode"));var me=require("child_process");var fe=require("fs"),K=b(require("path")),I=b(require("vscode")),le=pe();function de(){return I.workspace.getConfiguration("r")}function Ke(n){let e=":",t="";n==="win32"&&(e=";",t=".exe");let o=process.env.PATH?process.env.PATH.split(e):[];for(let r of o){let s=K.default.join(r,"R"+t);if((0,fe.existsSync)(s))return s}return""}async function je(){let n="",e=process.platform;if(n||(n=Ke(e)),!n&&e==="win32")try{let t=new le({hive:le.HKLM,key:"\\Software\\R-Core\\R"}),o=await new Promise((r,s)=>t.get("InstallPath",(i,u)=>i===null?r(u):s(i)));n=K.default.join(o.value,"bin","R.exe")}catch{n=""}return n}function Ye(n=!1){let e=n?"rterm":"rpath",t=process.platform==="win32"?"windows":process.platform==="darwin"?"mac":"linux";return`${e}.${t}`}async function he(n=!1,e){let t="";e&&(t=de().get(e));let o=Ye();return t||(t=de().get(o)),t||(t=await je()),t||(t=void 0),t?n&&/^[^'"].* .*[^'"]$/.exec(t)?t=`"${t}"`:n?process.platform==="win32"&&/^'.* .*'$/.exec(t)&&(t=t.replace(/^'(.*)'$/,'"$1"')):(t=t.replace(/^"(.*)"$/,"$1"),t=t.replace(/^'(.*)'$/,"$1")):I.window.showErrorMessage(`Cannot find R to use for help, package installation etc. Change setting r.${o} to R path.`),t}async function G(n,e={}){let t=await he();if(t===void 0)throw new Error("Can't get R path");let o="";return new Promise(r=>{var w;let s=new AbortController,{signal:i}=s,u=g=>e.verbose?console.log(`%c[RProc ${a.pid}] %c${g.replaceAll(/\n$/g,"").replaceAll(/\n/g,`
\u2219\u2219\u2219 `)}`,"color: orangered;","color: grey; opacity: 0.5"):null,a=(0,me.spawn)(t,n,{signal:i});function p(g,R){o+=`${g}: ${R}`}let f=()=>{u("spawned"),clearTimeout(v),r({proc:a,stop:E})},c=g=>{var R;u(`Error: 
${g.toString()}`),clearTimeout(v),(R=e.onError)==null||R.call(e,g)},l=()=>{var g;u("Closed"),clearTimeout(v),(g=e.onClose)==null||g.call(e)},h=g=>{var P;let R=g.toString();u(`stdout: 
${R}`),p("out",R),(P=e.onStdout)==null||P.call(e,R)},m=g=>{var P;let R=g.toString();u(`stderr: ${R}`),p("error",R),(P=e.onStderr)==null||P.call(e,R)};a.on("spawn",f),a.on("error",c),a.on("close",l),a.stdout.on("data",h),a.stderr.on("data",m);let E=()=>!a.pid||!a.connected?!0:(u(`Killing R process ${a.pid}`),a.off("spawn",f),a.off("error",c),a.off("close",l),a.stdout.off("data",h),a.stderr.off("data",m),process.kill(a.pid)),v=setTimeout(()=>{throw new Error(`Starting backend server failed.
 Logs:
`+o)},(w=e.timeout_ms)!=null?w:5e3)})}async function ge(){let n=await G(["--silent","--slave","--no-save","--no-restore"],{timeout_ms:5e3});return{...n,runCmd:(e,t)=>L(n.proc,e,t)}}function Ee(n,e){e.stdin.write(`${n}
`)}var ve="SUE_START_SIGNAL",ye="SUE_END_SIGNAL";function Ve(n,e){return t=>{n&&console.log(e+t)}}async function L(n,e,{timeout_ms:t=1e3,verbose:o=!1}={}){let r=Ve(o,"runRCommand: "),s="",i=!1,u=!1,a=[];return new Promise(p=>{function f(l){let m=l.toString().split(`
`);r("~~~Output chunk~~~");for(let E of m){if(s+=E+`
`,r(E),E.includes(ve)){u=!0;continue}if(!!u&&!(!i&&E.length===0)){if(E.includes(ye)){clearTimeout(c),p(a),r("Output finished"),n.stdout.off("data",f);break}i=!0,a.push(E)}}}n.stdout.on("data",f),n.stderr.on("data",l=>{r("stderr: "+l.toString())});let c=setTimeout(()=>{throw new Error(`Timeout, no response from run command within ${t}ms: ${e}
 Logs:
 ${s}`)},t);Ee(`print('${ve}');${e};print('${ye}')`,n)})}async function Re(n,e){return(await L(n.proc,`print(require(${e}, quietly = TRUE))`,{verbose:!1}))[0].includes("FALSE")?{status:"error",msg:Qe(e)}:{status:"success"}}function Qe(n){return`The ShinyUiEditor extension needs the \`${n}\` pkg installed. Install using \`remotes::install_github('rstudio/${n}')\` and restart the extension.`}function T(...n){return n.filter(t=>t!==void 0).reduce((t,o,r)=>(r===0?"":t+`
`)+o,"")}function M(n){return n.replace(/"/g,'\\"')}async function _e(n,e,t){return(await n.runCmd(`styler::style_text("${M(e)}", scope = "tokens")`,t)).reduce((r,s)=>r+`
`+s,"")}async function B(n,e){let t=Ze(n);try{let o=await e.runCmd(t,{verbose:!1});return JSON.parse(T(...o))}catch{throw new Error("Failed to generate new ui code from tree")}}function Ze(n,e=!0){let t=M(JSON.stringify(n,null,2)),o=e?"TRUE":"FALSE";return T("ui_tree <- jsonlite::fromJSON(",`  txt = "${t}",`,"  simplifyVector = FALSE",")",`new_ui_code <- shinyuieditor:::ui_tree_to_code(ui_tree, remove_namespace = ${o})`,"new_ui_code$text <- as.character(new_ui_code$text)","jsonlite::toJSON(new_ui_code, auto_unbox = TRUE)")}async function we(n,{uiTree:e,otherCode:{uiExtra:t,serverFunctionBody:o,serverExtra:r,serverLibraries:s}}){let{text:i,namespaces_removed:u}=await B(e,n),p=[...new Set([...s!=null?s:[],...u])].map(m=>`library(${m})`),f=["server <- function(input, output) {",o,"}"],c="ui <- "+T(...i),l=T(...p,t,"",c,"",r,"",...f,"","shinyApp(ui, server)");return await _e(n,l)}async function Te(n,e){let t=qe(n),o=await e.runCmd(t);try{let r=JSON.parse(o.reduce((s,i)=>s+`
`+i,""));return Object.keys(r).length===0?"EMPTY":r}catch{throw new Error("Could not get document as json. Content is not valid json")}}function qe(n){let e=M(n);return T(`app_lines <- strsplit("${e}", "\\n")[[1]]`,"jsonlite::toJSON(",'  shinyuieditor:::get_file_ui_definition_info(app_lines, "single-file"),',"  auto_unbox = TRUE",")")}var xe=b(require("path")),$=b(require("vscode"));var Pe=b(require("net"));async function Se(){return new Promise(n=>{let e=Pe.default.createServer();e.listen(0,()=>{var o;let t=(o=e.address)==null?void 0:o.call(e);if(typeof t=="string"||t===null)throw new Error("Failed to find a free port...");e.close(r=>n(t.port))})})}function Ae({pathToApp:n,onCrash:e,onInitiation:t,onReady:o,onFailToStart:r,onLogs:s}){let i="0.0.0.0",u=xe.default.parse(n).dir,a=null;async function p(){t(),f();try{let c=await Se(),l=await $.env.asExternalUri($.Uri.parse(`http://localhost:${c}`)),h=new RegExp(`listening on .+${c}`,"i"),m=T("options(shiny.autoreload = TRUE)",`shiny::runApp(appDir = "${u}", port = ${c}, host = "${i}")`);return a=await G(["--no-save","--no-restore","--silent","-e",m],{onStderr(E){h.test(E)&&o(l.toString()),s(E.split(`
`))},onClose:e,onError:e}),!0}catch{return r(),!1}}function f(){return a===null?!0:a.stop()}return{start:p,stop:f}}function Ce(){let n="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}var{showErrorMessage:Je}=y.window,F=class{constructor(e){this.context=e;this.RProcess=null;this.uiBounds=null;this.hasInitialized=!1;this.sendMessage=null;ge().then(t=>{this.RProcess=t})}static register(e){let t=new F(e);return y.window.registerCustomEditorProvider(F.viewType,t,{webviewOptions:{retainContextWhenHidden:!0}})}async resolveCustomTextEditor(e,t,o){t.webview.options={enableScripts:!0},t.webview.html=this.getHtmlForWebview(t.webview);let r=null,s=async()=>{var m,E,v;if(!this.RProcess)throw new Error("Failed to sync file state to client, no R process available");console.log("Generating app state");let c=e.getText();if(r!==null&&c.includes(r))return;if(!this.hasInitialized){let w=await Re(this.RProcess,"shinyuieditor");if(w.status==="error")throw(m=this.sendMessage)==null||m.call(this,{path:"BACKEND-ERROR",payload:w.msg}),Je(w.msg),new Error(w.msg);this.hasInitialized=!0}let h=await Te(c,this.RProcess);if(h==="EMPTY")(E=this.sendMessage)==null||E.call(this,{path:"TEMPLATE-CHOOSER",payload:"please?"});else{let{ui_bounds:w,ui_tree:g}=h;this.uiBounds=w,(v=this.sendMessage)==null||v.call(this,{path:"UPDATED-TREE",payload:g})}},i=Q(s,500),u=c=>c.uri.toString()===e.uri.toString(),a=y.workspace.onDidChangeTextDocument(c=>{u(c.document)&&i()}),p=y.workspace.onDidSaveTextDocument(c=>{u(c)&&i.flush()});t.onDidDispose(()=>{a.dispose(),p.dispose(),console.log("Editor window closed",e.fileName)});let f=Ae({pathToApp:e.fileName,onInitiation:()=>{var c;(c=this.sendMessage)==null||c.call(this,{path:"APP-PREVIEW-STATUS",payload:"LOADING"})},onReady:c=>{var l;(l=this.sendMessage)==null||l.call(this,{path:"APP-PREVIEW-STATUS",payload:{url:c}})},onFailToStart:()=>{var c;(c=this.sendMessage)==null||c.call(this,{path:"APP-PREVIEW-CRASH",payload:"Failed to start"})},onCrash:()=>{var c;(c=this.sendMessage)==null||c.call(this,{path:"APP-PREVIEW-CRASH",payload:"Crashed"})},onLogs:c=>{var l;(l=this.sendMessage)==null||l.call(this,{path:"APP-PREVIEW-LOGS",payload:c})}});t.webview.onDidReceiveMessage(async c=>{if(!this.sendMessage)throw new Error("Can't send message back to client, sendMessage not available.");if(!this.RProcess)throw new Error("No available R Process available, somethings gone wrong.");if(V(c))switch(c.path){case"READY-FOR-STATE":s();return;case"TEMPLATE-SELECTION":{let l=await we(this.RProcess,c.payload);await this.addUiTextToFile(l,e,"insert");return}case"UPDATED-TREE":{if(!this.RProcess||!this.uiBounds)throw new Error("No available R Process or ui bounds, can't update UI tree");let{uiText:l}=await this.updateAppUI(e,c.payload);r=l;return}case"APP-PREVIEW-REQUEST":{f.start();return}case"APP-PREVIEW-STOP":{f.stop();return}case"APP-PREVIEW-RESTART":{f.start();return}case"ENTERED-TEMPLATE-SELECTOR":{f.stop(),this.clearAppFile(e);return}default:console.warn("Unhandled message from client",c)}else console.log("Unknown message from webview",c)}),this.sendMessage=c=>t.webview.postMessage(c)}getHtmlForWebview(e){let t=e.asWebviewUri(y.Uri.joinPath(this.context.extensionUri,"media","build","bundle.js")),o=e.asWebviewUri(y.Uri.joinPath(this.context.extensionUri,"media","build","bundle.css")),r=Ce(),s=e.cspSource;return`
			<!DOCTYPE html>
			<html lang="en">
			<head>
				<meta charset="UTF-8">
				<script>
				// This is needed for various older packages that require the global
				// object to be defined because it typically was with older bundlers like
				// webpack
				var global = window;
			  <\/script>
				<!--
				Use a content security policy to only allow loading images from https or from our extension directory,
				and only allow scripts that have a specific nonce.
				-->
				<meta 
          http-equiv="Content-Security-Policy" 
          content="default-src 'none'; frame-src http://localhost:*/ ${s} https:; img-src ${s} data:; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">

				<meta name="viewport" content="width=device-width, initial-scale=1.0">

				
				<link href="${o}" rel="stylesheet" />
				
				<title>Shiny UI Editor</title>
			</head>
			<body>
				<noscript>You need to enable JavaScript to run this app.</noscript>
				<div id="root" style="height: 100vh; display: relative"></div>
				<script nonce="${r}" src="${t}"><\/script>
			</body>
			</html>`}async addUiTextToFile(e,t,o){let r=t.uri,s=new y.WorkspaceEdit;if(o==="replace"){let{start:i,end:u}=this.uiBounds||{start:0,end:0},a=new y.Range(i-1,0,u,0);s.replace(r,a,e)}o==="insert"&&s.insert(t.uri,new y.Position(0,0),e),await y.workspace.applyEdit(s),t.save()}async clearAppFile(e){let t=e.uri,o=new y.WorkspaceEdit,r=e.validateRange(new y.Range(0,0,1/0,1/0));o.replace(t,r,""),await y.workspace.applyEdit(o),e.save()}async updateAppUI(e,t){if(!this.RProcess)throw new Error("Can't access R to build new ui code");if(!this.uiBounds)throw new Error("Attempting to update an app that has yet to be parsed.");let{start:o,end:r}=this.uiBounds,s=await B(t,this.RProcess),i=`ui <- ${T(...s.text)}
`;await this.addUiTextToFile(i,e,"replace");let u=r-o+1,p=s.text.length-u;return this.uiBounds={start:o,end:r+p},{uiText:i}}},D=F;D.viewType="shinyUiEditor.appFile";function ze(n){n.subscriptions.push(D.register(n))}0&&(module.exports={activate});
