"use strict";var Ue=Object.create;var N=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,ke=Object.prototype.hasOwnProperty;var De=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),Ne=(o,e)=>{for(var t in e)N(o,t,{get:e[t],enumerable:!0})},Y=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Me(e))!ke.call(o,r)&&r!==t&&N(o,r,{get:()=>e[r],enumerable:!(n=Oe(e,r))||n.enumerable});return o};var O=(o,e,t)=>(t=o!=null?Ue(be(o)):{},Y(e||!o||!o.__esModule?N(t,"default",{value:o,enumerable:!0}):t,o)),Ie=o=>Y(N({},"__esModule",{value:!0}),o);var le=De((rt,pe)=>{var $=require("util"),Be=require("path"),S=require("child_process").spawn,T=function(){},H="HKLM",q="HKCU",J="HKCR",z="HKU",X="HKCC",ee=[H,q,J,z,X],te="REG_SZ",oe="REG_MULTI_SZ",ne="REG_EXPAND_SZ",re="REG_DWORD",ie="REG_QWORD",se="REG_BINARY",ae="REG_NONE",ue=[te,oe,ne,re,ie,se,ae],Fe="",We=/(\\[a-zA-Z0-9_\s]+)*/,$e=/^(HKEY_LOCAL_MACHINE|HKEY_CURRENT_USER|HKEY_CLASSES_ROOT|HKEY_USERS|HKEY_CURRENT_CONFIG)(.*)$/,ce=/^(.*)\s(REG_SZ|REG_MULTI_SZ|REG_EXPAND_SZ|REG_DWORD|REG_QWORD|REG_BINARY|REG_NONE)\s+([^\s].*)$/;function b(o,e){if(!(this instanceof b))return new b(o,e);Error.captureStackTrace(this,b),this.__defineGetter__("name",function(){return b.name}),this.__defineGetter__("message",function(){return o}),this.__defineGetter__("code",function(){return e})}$.inherits(b,Error);function x(o){var e={stdout:"",stderr:""};return o.stdout.on("data",function(t){e.stdout+=t.toString()}),o.stderr.on("data",function(t){e.stderr+=t.toString()}),e}function A(o,e,t){var n=t.stdout.trim(),r=t.stderr.trim(),i=$.format(`%s command exited with code %d:
%s
%s`,o,e,n,r);return new b(i,e)}function He(o){if(o=="x64")return"64";if(o=="x86")return"32";throw new Error("illegal architecture: "+o+" (use x86 or x64)")}function C(o,e){e&&o.push("/reg:"+He(e))}function U(){return process.platform==="win32"?Be.join(process.env.windir,"system32","reg.exe"):"REG"}function k(o,e,t,n,r,i,s){if(!(this instanceof k))return new k(o,e,t,n,r,i,s);var c=o,a=e,p=t,m=n,l=r,u=i,d=s;this.__defineGetter__("host",function(){return c}),this.__defineGetter__("hive",function(){return a}),this.__defineGetter__("key",function(){return p}),this.__defineGetter__("name",function(){return m}),this.__defineGetter__("type",function(){return l}),this.__defineGetter__("value",function(){return u}),this.__defineGetter__("arch",function(){return d})}$.inherits(k,Object);function f(o){if(!(this instanceof f))return new f(o);var e=o||{},t=""+(e.host||""),n=""+(e.hive||H),r=""+(e.key||""),i=e.arch||null;if(this.__defineGetter__("host",function(){return t}),this.__defineGetter__("hive",function(){return n}),this.__defineGetter__("key",function(){return r}),this.__defineGetter__("path",function(){return(t.length==0?"":"\\\\"+t+"\\")+n+r}),this.__defineGetter__("arch",function(){return i}),this.__defineGetter__("parent",function(){var s=r.lastIndexOf("\\");return new f({host:this.host,hive:this.hive,key:s==-1?"":r.substring(0,s),arch:this.arch})}),ee.indexOf(n)==-1)throw new Error("illegal hive specified.");if(!We.test(r))throw new Error("illegal key specified.");if(i&&i!="x64"&&i!="x86")throw new Error("illegal architecture specified (use x86 or x64)")}f.HKLM=H;f.HKCU=q;f.HKCR=J;f.HKU=z;f.HKCC=X;f.HIVES=ee;f.REG_SZ=te;f.REG_MULTI_SZ=oe;f.REG_EXPAND_SZ=ne;f.REG_DWORD=re;f.REG_QWORD=ie;f.REG_BINARY=se;f.REG_NONE=ae;f.REG_TYPES=ue;f.DEFAULT_VALUE=Fe;f.prototype.values=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["QUERY",this.path];C(t,this.arch);var n=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r="",i=this,s=null,c=x(n);return n.on("close",function(a){if(!s)if(a!==0)T("process exited with code "+a),e(A("QUERY",a,c),null);else{for(var p=[],m=[],l=r.split(`
`),u=0,d=0,g=l.length;d<g;d++){var v=l[d].trim();v.length>0&&(T(v),u!=0&&p.push(v),++u)}for(var d=0,g=p.length;d<g;d++){var y=ce.exec(p[d]),_,h,R;y&&(_=y[1].trim(),h=y[2].trim(),R=y[3],m.push(new k(i.host,i.hive,i.key,_,h,R,i.arch)))}e(null,m)}}),n.stdout.on("data",function(a){r+=a.toString()}),n.on("error",function(a){s=a,e(a)}),this};f.prototype.keys=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["QUERY",this.path];C(t,this.arch);var n=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r="",i=this,s=null,c=x(n);return n.on("close",function(a){s||a!==0&&(T("process exited with code "+a),e(A("QUERY",a,c),null))}),n.stdout.on("data",function(a){r+=a.toString()}),n.stdout.on("end",function(){for(var a=[],p=[],m=r.split(`
`),l=0,u=m.length;l<u;l++){var d=m[l].trim();d.length>0&&(T(d),a.push(d))}for(var l=0,u=a.length;l<u;l++){var g=$e.exec(a[l]),v,y;g&&(v=g[1],y=g[2],y&&y!==i.key&&p.push(new f({host:i.host,hive:i.hive,key:y,arch:i.arch})))}e(null,p)}),n.on("error",function(a){s=a,e(a)}),this};f.prototype.get=function(e,t){if(typeof t!="function")throw new TypeError("must specify a callback");var n=["QUERY",this.path];e==""?n.push("/ve"):n=n.concat(["/v",e]),C(n,this.arch);var r=S(U(),n,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),i="",s=this,c=null,a=x(r);return r.on("close",function(p){if(!c)if(p!==0)T("process exited with code "+p),t(A("QUERY",p,a),null);else{for(var m=[],l=null,u=i.split(`
`),d=0,g=0,v=u.length;g<v;g++){var y=u[g].trim();y.length>0&&(T(y),d!=0&&m.push(y),++d)}var _=m[m.length-1]||"",h=ce.exec(_),R,P,j;h&&(R=h[1].trim(),P=h[2].trim(),j=h[3],l=new k(s.host,s.hive,s.key,R,P,j,s.arch)),t(null,l)}}),r.stdout.on("data",function(p){i+=p.toString()}),r.on("error",function(p){c=p,t(p)}),this};f.prototype.set=function(e,t,n,r){if(typeof r!="function")throw new TypeError("must specify a callback");if(ue.indexOf(t)==-1)throw Error("illegal type specified.");var i=["ADD",this.path];e==""?i.push("/ve"):i=i.concat(["/v",e]),i=i.concat(["/t",t,"/d",n,"/f"]),C(i,this.arch);var s=S(U(),i,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),c=null,a=x(s);return s.on("close",function(p){c||(p!==0?(T("process exited with code "+p),r(A("ADD",p,a,null))):r(null))}),s.stdout.on("data",function(p){T(""+p)}),s.on("error",function(p){c=p,r(p)}),this};f.prototype.remove=function(e,t){if(typeof t!="function")throw new TypeError("must specify a callback");var n=e?["DELETE",this.path,"/f","/v",e]:["DELETE",this.path,"/f","/ve"];C(n,this.arch);var r=S(U(),n,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),i=null,s=x(r);return r.on("close",function(c){i||(c!==0?(T("process exited with code "+c),t(A("DELETE",c,s),null)):t(null))}),r.stdout.on("data",function(c){T(""+c)}),r.on("error",function(c){i=c,t(c)}),this};f.prototype.clear=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["DELETE",this.path,"/f","/va"];C(t,this.arch);var n=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r=null,i=x(n);return n.on("close",function(s){r||(s!==0?(T("process exited with code "+s),e(A("DELETE",s,i),null)):e(null))}),n.stdout.on("data",function(s){T(""+s)}),n.on("error",function(s){r=s,e(s)}),this};f.prototype.erase=f.prototype.clear;f.prototype.destroy=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["DELETE",this.path,"/f"];C(t,this.arch);var n=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r=null,i=x(n);return n.on("close",function(s){r||(s!==0?(T("process exited with code "+s),e(A("DELETE",s,i),null)):e(null))}),n.stdout.on("data",function(s){T(""+s)}),n.on("error",function(s){r=s,e(s)}),this};f.prototype.create=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["ADD",this.path,"/f"];C(t,this.arch);var n=S(U(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),r=null,i=x(n);return n.on("close",function(s){r||(s!==0?(T("process exited with code "+s),e(A("ADD",s,i),null)):e(null))}),n.stdout.on("data",function(s){T(""+s)}),n.on("error",function(s){r=s,e(s)}),this};f.prototype.keyExists=function(e){return this.values(function(t,n){if(t)return t.code==1?e(null,!1):e(t);e(null,!0)}),this};f.prototype.valueExists=function(e,t){return this.get(e,function(n,r){if(n)return n.code==1?t(null,!1):t(n);t(null,!0)}),this};pe.exports=f});var Xe={};Ne(Xe,{activate:()=>ze});module.exports=Ie(Xe);function Le(o){return typeof o=="object"&&o!==null}function V(o){return Le(o)?"path"in o:!1}var Q=Ge;function Ge(o,e,t){var n=null,r=null,i=function(){n&&(clearTimeout(n),r=null,n=null)},s=function(){var a=r;i(),a&&a()},c=function(){if(!e)return o.apply(this,arguments);var a=this,p=arguments,m=t&&!n;if(i(),r=function(){o.apply(a,p)},n=setTimeout(function(){if(n=null,!m){var l=r;return r=null,l()}},e),m)return r()};return c.cancel=i,c.flush=s,c}var E=O(require("vscode"));var me=require("child_process");var fe=require("fs"),K=O(require("path")),I=O(require("vscode"));function w(...o){return o.filter(t=>t!==void 0).reduce((t,n,r)=>(r===0?"":t+`
`)+n,"")}function M(o){return o.replace(/"/g,'\\"')}function Z(o){return o.replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var de=le();function Ke(o){let e=":",t="";o==="win32"&&(e=";",t=".exe");let n=process.env.PATH?process.env.PATH.split(e):[];for(let r of n){let i=K.default.join(r,"R"+t);if((0,fe.existsSync)(i))return i}return""}async function je(){let o=process.platform,e=Ke(o);if(!e&&o==="win32")try{let t=new de({hive:de.HKLM,key:"\\Software\\R-Core\\R"}),n=await new Promise((r,i)=>t.get("InstallPath",(s,c)=>s===null?r(c):i(s)));e=K.default.join(n.value,"bin","R.exe")}catch{e=""}return e}function Ye(){return`rpath.${process.platform==="win32"?"windows":process.platform==="darwin"?"mac":"linux"}`}async function he(){let o=Ye(),e=I.workspace.getConfiguration("r").get(o);return e||(e=await je()),e||I.window.showErrorMessage(`Cannot find R for running shinyuieditor. Make sure R is installed and/or updating the r.${o} config option to proper to R path.`),Z(e)}async function L(o,e={}){let t=await he();if(t===void 0)throw new Error("Can't get R path");let n="";return new Promise(r=>{var _;let i=new AbortController,{signal:s}=i,c=h=>e.verbose?console.log(`%c[RProc ${a.pid}] %c${h.replaceAll(/\n$/g,"").replaceAll(/\n/g,`
\u2219\u2219\u2219 `)}`,"color: orangered;","color: grey; opacity: 0.5"):null,a=(0,me.spawn)(t,o,{signal:s});function p(h,R){n+=`${h}: ${R}`}let m=()=>{c("spawned"),clearTimeout(y),r({proc:a,stop:v})},l=h=>{var R;c(`Error: 
${h.toString()}`),clearTimeout(y),(R=e.onError)==null||R.call(e,h)},u=()=>{var h;c("Closed"),clearTimeout(y),(h=e.onClose)==null||h.call(e)},d=h=>{var P;let R=h.toString();c(`stdout: 
${R}`),p("out",R),(P=e.onStdout)==null||P.call(e,R)},g=h=>{var P;let R=h.toString();c(`stderr: ${R}`),p("error",R),(P=e.onStderr)==null||P.call(e,R)};a.on("spawn",m),a.on("error",l),a.on("close",u),a.stdout.on("data",d),a.stderr.on("data",g);let v=()=>!a.pid||!a.connected?!0:(c(`Killing R process ${a.pid}`),a.off("spawn",m),a.off("error",l),a.off("close",u),a.stdout.off("data",d),a.stderr.off("data",g),process.kill(a.pid)),y=setTimeout(()=>{throw new Error(`Starting backend server failed.
 Logs:
`+n)},(_=e.timeout_ms)!=null?_:5e3)})}async function ge(){let o=await L(["--silent","--slave","--no-save","--no-restore"],{timeout_ms:5e3});return{...o,runCmd:(e,t)=>G(o.proc,e,t)}}function Ee(o,e){e.stdin.write(`${o}
`)}var ve="SUE_START_SIGNAL",ye="SUE_END_SIGNAL";function Ve(o,e){return t=>{o&&console.log(e+t)}}async function G(o,e,{timeout_ms:t=1e3,verbose:n=!1}={}){let r=Ve(n,"runRCommand: "),i="",s=!1,c=!1,a=[];return new Promise(p=>{function m(u){let g=u.toString().split(`
`);r("~~~Output chunk~~~");for(let v of g){if(i+=v+`
`,r(v),v.includes(ve)){c=!0;continue}if(!!c&&!(!s&&v.length===0)){if(v.includes(ye)){clearTimeout(l),p(a),r("Output finished"),o.stdout.off("data",m);break}s=!0,a.push(v)}}}o.stdout.on("data",m),o.stderr.on("data",u=>{r("stderr: "+u.toString())});let l=setTimeout(()=>{throw new Error(`Timeout, no response from run command within ${t}ms: ${e}
 Logs:
 ${i}`)},t);Ee(`print('${ve}');${e};print('${ye}')`,o)})}async function Re(o,e){return(await G(o.proc,`print(require(${e}, quietly = TRUE))`,{verbose:!1}))[0].includes("FALSE")?{status:"error",msg:Qe(e)}:{status:"success"}}function Qe(o){return`The ShinyUiEditor extension needs the \`${o}\` pkg installed. Install using \`remotes::install_github('rstudio/${o}')\` and restart the extension.`}async function Te(o,e,t){return(await o.runCmd(`styler::style_text("${M(e)}", scope = "tokens")`,t)).reduce((r,i)=>r+`
`+i,"")}async function B(o,e){let t=Ze(o);try{let n=await e.runCmd(t,{verbose:!1});return JSON.parse(w(...n))}catch{throw new Error("Failed to generate new ui code from tree")}}function Ze(o,e=!0){let t=M(JSON.stringify(o,null,2)),n=e?"TRUE":"FALSE";return w("ui_tree <- jsonlite::fromJSON(",`  txt = "${t}",`,"  simplifyVector = FALSE",")",`new_ui_code <- shinyuieditor:::ui_tree_to_code(ui_tree, remove_namespace = ${n})`,"new_ui_code$text <- as.character(new_ui_code$text)","jsonlite::toJSON(new_ui_code, auto_unbox = TRUE)")}async function we(o,{uiTree:e,otherCode:{uiExtra:t,serverFunctionBody:n,serverExtra:r,serverLibraries:i}}){let{text:s,namespaces_removed:c}=await B(e,o),p=[...new Set([...i!=null?i:[],...c])].map(g=>`library(${g})`),m=["server <- function(input, output) {",n,"}"],l="ui <- "+w(...s),u=w(...p,t,"",l,"",r,"",...m,"","shinyApp(ui, server)");return await Te(o,u)}async function _e(o,e){let t=qe(o),n=await e.runCmd(t);try{let r=JSON.parse(n.reduce((i,s)=>i+`
`+s,""));return Object.keys(r).length===0?"EMPTY":r}catch{throw new Error("Could not get document as json. Content is not valid json")}}function qe(o){let e=M(o);return w(`app_lines <- strsplit("${e}", "\\n")[[1]]`,"jsonlite::toJSON(",'  shinyuieditor:::get_file_ui_definition_info(app_lines, "single-file"),',"  auto_unbox = TRUE",")")}var xe=O(require("path")),F=O(require("vscode"));var Pe=O(require("net"));async function Se(){return new Promise(o=>{let e=Pe.default.createServer();e.listen(0,()=>{var n;let t=(n=e.address)==null?void 0:n.call(e);if(typeof t=="string"||t===null)throw new Error("Failed to find a free port...");e.close(r=>o(t.port))})})}function Ae({pathToApp:o,onCrash:e,onInitiation:t,onReady:n,onFailToStart:r,onLogs:i}){let s="0.0.0.0",c=xe.default.parse(o).dir,a=null;async function p(){t(),m();try{let l=await Se(),u=await F.env.asExternalUri(F.Uri.parse(`http://localhost:${l}`)),d=new RegExp(`listening on .+${l}`,"i"),g=w("options(shiny.autoreload = TRUE)",`shiny::runApp(appDir = "${c}", port = ${l}, host = "${s}")`);return a=await L(["--no-save","--no-restore","--silent","-e",g],{onStderr(v){d.test(v)&&n(u.toString()),i(v.split(`
`))},onClose:e,onError:e}),!0}catch{return r(),!1}}function m(){return a===null?!0:a.stop()}return{start:p,stop:m}}function Ce(){let o="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)o+=e.charAt(Math.floor(Math.random()*e.length));return o}var{showErrorMessage:Je}=E.window,W=class{constructor(e){this.context=e;this.RProcess=null;this.uiBounds=null;this.hasInitialized=!1;this.sendMessage=null;ge().then(t=>{this.RProcess=t})}static register(e){let t=new W(e);return E.window.registerCustomEditorProvider(W.viewType,t,{webviewOptions:{retainContextWhenHidden:!0}})}async openCodeCompanion(e){return await E.window.showTextDocument(e.uri,{viewColumn:E.ViewColumn.Beside})}async resolveCustomTextEditor(e,t,n){t.webview.options={enableScripts:!0},t.webview.html=this.getHtmlForWebview(t.webview);let r=null,i=null,s=async()=>{var v,y,_;if(!this.RProcess)throw new Error("Failed to sync file state to client, no R process available");console.log("Generating app state");let u=e.getText();if(r!==null&&u.includes(r))return;if(!this.hasInitialized){let h=await Re(this.RProcess,"shinyuieditor");if(h.status==="error")throw(v=this.sendMessage)==null||v.call(this,{path:"BACKEND-ERROR",payload:h.msg}),Je(h.msg),new Error(h.msg);this.hasInitialized=!0}let g=await _e(u,this.RProcess);if(g==="EMPTY")(y=this.sendMessage)==null||y.call(this,{path:"TEMPLATE_CHOOSER",payload:"SINGLE-FILE"});else{let{ui_bounds:h,ui_tree:R}=g;this.uiBounds=h,(_=this.sendMessage)==null||_.call(this,{path:"UPDATED-TREE",payload:R})}},c=Q(s,500),a=u=>u.uri.toString()===e.uri.toString(),p=E.workspace.onDidChangeTextDocument(u=>{a(u.document)&&c()}),m=E.workspace.onDidSaveTextDocument(u=>{a(u)&&c.flush()});t.onDidDispose(()=>{p.dispose(),m.dispose(),console.log("Editor window closed",e.fileName)});let l=Ae({pathToApp:e.fileName,onInitiation:()=>{var u;(u=this.sendMessage)==null||u.call(this,{path:"APP-PREVIEW-STATUS",payload:"LOADING"})},onReady:u=>{var d;(d=this.sendMessage)==null||d.call(this,{path:"APP-PREVIEW-STATUS",payload:{url:u}})},onFailToStart:()=>{var u;(u=this.sendMessage)==null||u.call(this,{path:"APP-PREVIEW-CRASH",payload:"Failed to start"})},onCrash:()=>{var u;(u=this.sendMessage)==null||u.call(this,{path:"APP-PREVIEW-CRASH",payload:"Crashed"})},onLogs:u=>{var d;(d=this.sendMessage)==null||d.call(this,{path:"APP-PREVIEW-LOGS",payload:u})}});t.webview.onDidReceiveMessage(async u=>{var d;if(!this.sendMessage)throw new Error("Can't send message back to client, sendMessage not available.");if(!this.RProcess)throw new Error("No available R Process available, somethings gone wrong.");if(V(u))switch(u.path){case"READY-FOR-STATE":s(),(d=this.sendMessage)==null||d.call(this,{path:"RUNTIME-TYPE",payload:"VSCODE"});return;case"TEMPLATE-SELECTION":{let g=await we(this.RProcess,u.payload);await this.addUiTextToFile(g,e,"insert");return}case"UPDATED-TREE":{if(!this.RProcess||!this.uiBounds)throw new Error("No available R Process or ui bounds, can't update UI tree");let{uiText:g}=await this.updateAppUI(e,u.payload);r=g;return}case"APP-PREVIEW-REQUEST":{l.start();return}case"APP-PREVIEW-STOP":{l.stop();return}case"APP-PREVIEW-RESTART":{l.start();return}case"ENTERED-TEMPLATE-SELECTOR":{l.stop(),this.clearAppFile(e);return}case"OPEN-COMPANION-EDITOR":{if(i&&E.window.visibleTextEditors.includes(i))return;i=await this.openCodeCompanion(e);return}default:console.warn("Unhandled message from client",u)}else console.log("Unknown message from webview",u)}),this.sendMessage=u=>t.webview.postMessage(u)}getHtmlForWebview(e){let t=e.asWebviewUri(E.Uri.joinPath(this.context.extensionUri,"media","build","bundle.js")),n=e.asWebviewUri(E.Uri.joinPath(this.context.extensionUri,"media","build","bundle.css")),r=Ce(),i=e.cspSource;return`
			<!DOCTYPE html>
			<html lang="en">
			<head>
				<meta charset="UTF-8">
				<script>
				// This is needed for various older packages that require the global
				// object to be defined because it typically was with older bundlers like
				// webpack
				var global = window;
			  <\/script>
				<!--
				Use a content security policy to only allow loading images from https or from our extension directory,
				and only allow scripts that have a specific nonce.
				-->
				<meta 
          http-equiv="Content-Security-Policy" 
          content="default-src 'none'; frame-src http://localhost:*/ ${i} https:; img-src ${i} data:; style-src ${e.cspSource} 'unsafe-inline'; script-src 'nonce-${r}';">

				<meta name="viewport" content="width=device-width, initial-scale=1.0">

				
				<link href="${n}" rel="stylesheet" />
				
				<title>Shiny UI Editor</title>
			</head>
			<body>
				<noscript>You need to enable JavaScript to run this app.</noscript>
				<div id="root" style="height: 100vh; display: relative"></div>
				<script nonce="${r}" src="${t}"><\/script>
			</body>
			</html>`}async addUiTextToFile(e,t,n){let r=t.uri,i=new E.WorkspaceEdit;if(n==="replace"){let{start:s,end:c}=this.uiBounds||{start:0,end:0},a=new E.Range(s-1,0,c,0);i.replace(r,a,e)}n==="insert"&&i.insert(t.uri,new E.Position(0,0),e),await E.workspace.applyEdit(i),t.save()}async clearAppFile(e){let t=e.uri,n=new E.WorkspaceEdit,r=e.validateRange(new E.Range(0,0,1/0,1/0));n.replace(t,r,""),await E.workspace.applyEdit(n),e.save()}async updateAppUI(e,t){if(!this.RProcess)throw new Error("Can't access R to build new ui code");if(!this.uiBounds)throw new Error("Attempting to update an app that has yet to be parsed.");let{start:n,end:r}=this.uiBounds,i=await B(t,this.RProcess),s=`ui <- ${w(...i.text)}
`;await this.addUiTextToFile(s,e,"replace");let c=r-n+1,p=i.text.length-c;return this.uiBounds={start:n,end:r+p},{uiText:s}}},D=W;D.viewType="shinyUiEditor.appFile";function ze(o){o.subscriptions.push(D.register(o))}0&&(module.exports={activate});
